import{_ as E,C as z}from"./Skeleton.vue_vue_type_script_setup_true_lang-1LsvZ6Gu.js";import{c as D,N as I,o as t,i as d,F as C,E as J,D as s,e as c,d as S,A,a as f,w as u,aC as L,C as _,B as q,u as n,G as T,n as F,J as k,ad as V,_ as H,M,v as P,x as j,y as N,a8 as G}from"./index-oeNR1G6E.js";import{_ as O}from"./ScrollArea.vue_vue_type_script_setup_true_lang-xKcTjEdv.js";import{_ as U}from"./Badge.vue_vue_type_script_setup_true_lang-QbH99PoX.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=D("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),Q={},W={class:"space-y-5"},X={class:"space-y-2 col-span-5"},Y={class:"space-y-2 col-span-5"},Z={class:"flex gap-2"};function ss(B,m){const i=E;return t(),d("ul",W,[(t(),d(C,null,J(4,r=>s("li",{key:r,class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},[s("div",X,[c(i,{class:"h-4 w-[300px]"}),c(i,{class:"h-4 w-[500px]"}),c(i,{class:"h-4 w-[400px]"})]),s("div",Y,[s("ul",Z,[s("li",null,[c(i,{class:"h-4 w-[80px]"})]),s("li",null,[c(i,{class:"h-4 w-[130px]"})]),s("li",null,[c(i,{class:"h-4 w-[120px]"})])]),c(i,{class:"h-4 w-[100px]"})])])),64))])}const es=I(Q,[["render",ss]]),ts={class:"space-y-5"},os={class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},ns={class:"space-y-2 col-span-5"},as={class:"font-medium"},cs={class:"text-muted-foreground"},is={class:"space-y-2 col-span-5"},ls={class:"flex gap-2"},rs={class:"flex items-center justify-end"},ds={key:0},_s={class:"w-[70%] ml-auto mt-5 flex gap-5 items-center"},ps={class:"px-5 py-3 border rounded-md grow flex gap-5 items-center"},us={class:"space-y-5 grow"},ms={class:"flex"},hs=s("span",{class:"w-20 shrink-0"},"from",-1),fs={class:"font-medium"},gs={class:"flex"},ys=s("span",{class:"w-20 shrink-0"},"message:",-1),bs={class:"px-3 py-2 bg-secondary border rounded-md grow"},vs=S({__name:"RequestSection",props:{jobs:{}},emits:["accept"],setup(B,{emit:m}){const i=m,r=A(-1);return(h,v)=>{const g=U,y=H,b=M,$=L("RouterLink"),p=O;return t(),f(p,{class:"h-[500px]"},{default:u(()=>[s("ul",ts,[(t(!0),d(C,null,J(h.jobs,e=>(t(),d("li",{key:e.id},[s("div",os,[s("div",ns,[s("div",as,_(e.title)+" #"+_(e.id),1),s("div",cs,_(e.description),1)]),s("div",is,[s("ul",ls,[(t(!0),d(C,null,J(e.tags,(a,l)=>(t(),d("li",{key:l},[c(g,{variant:"secondary"},{default:u(()=>[q(_(a),1)]),_:2},1024)]))),128))]),c(y,null,{default:u(()=>[q(_(("toETH"in h?h.toETH:n(T))(e.price)),1)]),_:2},1024)]),s("div",rs,[c(b,{disabled:!e.requests.length,variant:"outline",size:"icon",onClick:a=>r.value=n(r)===e.id?-1:e.id},{default:u(()=>[c(n(z),{class:F(["transition-transform",{"rotate-180":e.id===n(r)}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])])]),c(V,{"enter-active-class":"transition-all duration-500 ease","leave-active-class":"transition-all duration-500 ease","enter-from-class":"opacity-0 translate-x-[10rem]","leave-to-class":"opacity-0 translate-x-[10rem]"},{default:u(()=>[e.requests.length&&e.id===n(r)?(t(),d("ul",ds,[(t(!0),d(C,null,J(e.requests,a=>(t(),d("li",{key:a.id},[s("div",_s,[c(n(K),{size:16}),s("div",ps,[s("div",us,[s("div",ms,[hs,s("span",fs,_(a.buyer),1)]),s("div",gs,[ys,s("div",bs,_(a.message),1)])]),a.accepted?(t(),f($,{key:0,to:{path:"/chats",query:{id:a.escrowId}}},{default:u(()=>[c(b,null,{default:u(()=>[q("chat")]),_:1})]),_:2},1032,["to"])):(t(),f(b,{key:1,onClick:l=>i("accept",n(r),a.id)},{default:u(()=>[q(" accept ")]),_:2},1032,["onClick"]))])])]))),128))])):k("",!0)]),_:2},1024)]))),128))])]),_:1})}}}),ws={class:"py-10 space-y-10"},xs={class:"space-y-5"},ks={class:"text-2xl font-medium flex items-center gap-1"},$s=s("p",null,"pending",-1),qs={class:"text-muted-foreground text-base"},Cs={class:"space-y-5"},Js={class:"text-2xl font-medium flex items-center gap-1"},Rs=s("p",null,"accepted",-1),Bs={class:"text-muted-foreground text-base"},zs=S({__name:"requests",async setup(B){let m,i;const r=P(),h=([m,i]=j(()=>r.getJobFactory()),m=await m,i(),m),v=N([]),g=N([]),y=A(!1);async function b(){y.value=!0;const p=(await h.getAllJobsOfUser(r.address)).map(o=>({owner:o[0],id:Number(o[1]),title:o[2],description:o[3],price:o[4],inProcess:o[5],tags:o[6],requests:[]})),e=p.map(o=>h.getJobBuyRequests(o.id));(await Promise.all(e)).forEach((o,w)=>{const R=o.map(x=>({id:Number(x[1]),buyer:x[2],message:x[3],accepted:x[4],escrowId:Number(x[5])}));p[w].requests.push(...R)});const l=p.reduce((o,w)=>(w.requests.some(R=>R.accepted)?o.acceptedJobs.push(w):o.pendingJobs.push(w),o),{pendingJobs:[],acceptedJobs:[]});v.value=l.pendingJobs,g.value=l.acceptedJobs,y.value=!1}G(()=>{b()});async function $(p,e){const l=await(await h.acceptBuyRequest(p,e)).wait();(l==null?void 0:l.status)===1&&await b()}return(p,e)=>{const a=vs,l=es;return t(),d("div",ws,[s("div",xs,[s("h2",ks,[$s,s("span",qs," ("+_(n(v).length)+") ",1)]),n(v).length?(t(),f(a,{key:0,jobs:n(v),onAccept:$},null,8,["jobs"])):k("",!0),n(y)?(t(),f(l,{key:1})):k("",!0)]),s("div",Cs,[s("h2",Js,[Rs,s("span",Bs," ("+_(n(g).length)+") ",1)]),n(g).length?(t(),f(a,{key:0,jobs:n(g),onAccept:$},null,8,["jobs"])):k("",!0),n(y)?(t(),f(l,{key:1})):k("",!0)])])}}});export{zs as default};
