import{a as A,C as I,_ as L}from"./Skeleton.vue_vue_type_script_setup_true_lang-At-CHLli.js";import{c as D,N as F,o as t,j as d,F as C,E as J,D as s,f as c,d as S,z,a as h,w as u,as as V,C as _,B as q,u as a,k as E,aa as P,I as k,_ as j,L as M,t as T,v as O,x as N,a6 as U}from"./index-M8jWnzvA.js";import{_ as G}from"./ScrollArea.vue_vue_type_script_setup_true_lang-BdIX_W83.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=D("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),K={},Q={class:"space-y-5"},W={class:"space-y-2 col-span-5"},X={class:"space-y-2 col-span-5"},Y={class:"flex gap-2"};function Z(B,m){const i=A;return t(),d("ul",Q,[(t(),d(C,null,J(4,r=>s("li",{key:r,class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},[s("div",W,[c(i,{class:"h-4 w-[300px]"}),c(i,{class:"h-4 w-[500px]"}),c(i,{class:"h-4 w-[400px]"})]),s("div",X,[s("ul",Y,[s("li",null,[c(i,{class:"h-4 w-[80px]"})]),s("li",null,[c(i,{class:"h-4 w-[130px]"})]),s("li",null,[c(i,{class:"h-4 w-[120px]"})])]),c(i,{class:"h-4 w-[100px]"})])])),64))])}const ss=F(K,[["render",Z]]),es={class:"space-y-5"},ts={class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},os={class:"space-y-2 col-span-5"},ns={class:"font-medium"},as={class:"text-muted-foreground"},cs={class:"space-y-2 col-span-5"},is={class:"flex gap-2"},ls={class:"flex items-center justify-end"},rs={key:0},ds={class:"w-[70%] ml-auto mt-5 flex gap-5 items-center"},_s={class:"px-5 py-3 border rounded-md grow flex gap-5 items-center"},ps={class:"space-y-5 grow"},us={class:"flex"},ms=s("span",{class:"w-20 shrink-0"},"from",-1),hs={class:"font-medium"},fs={class:"flex"},gs=s("span",{class:"w-20 shrink-0"},"message:",-1),ys={class:"px-3 py-2 bg-secondary border rounded-md grow"},bs=S({__name:"RequestSection",props:{jobs:{}},emits:["accept"],setup(B,{emit:m}){const i=m,r=z(-1);return(b,v)=>{const f=L,g=j,y=M,$=V("RouterLink"),p=G;return t(),h(p,{class:"h-[500px]"},{default:u(()=>[s("ul",es,[(t(!0),d(C,null,J(b.jobs,e=>(t(),d("li",{key:e.id},[s("div",ts,[s("div",os,[s("div",ns,_(e.title)+" #"+_(e.id),1),s("div",as,_(e.description),1)]),s("div",cs,[s("ul",is,[(t(!0),d(C,null,J(e.tags,(n,l)=>(t(),d("li",{key:l},[c(f,{variant:"secondary"},{default:u(()=>[q(_(n),1)]),_:2},1024)]))),128))]),c(g,null,{default:u(()=>[q(_(e.price),1)]),_:2},1024)]),s("div",ls,[c(y,{disabled:!e.requests.length,variant:"outline",size:"icon",onClick:n=>r.value=a(r)===e.id?-1:e.id},{default:u(()=>[c(a(I),{class:E(["transition-transform",{"rotate-180":e.id===a(r)}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])])]),c(P,{"enter-active-class":"transition-all duration-500 ease","leave-active-class":"transition-all duration-500 ease","enter-from-class":"opacity-0 translate-x-[10rem]","leave-to-class":"opacity-0 translate-x-[10rem]"},{default:u(()=>[e.requests.length&&e.id===a(r)?(t(),d("ul",rs,[(t(!0),d(C,null,J(e.requests,n=>(t(),d("li",{key:n.id},[s("div",ds,[c(a(H),{size:16}),s("div",_s,[s("div",ps,[s("div",us,[ms,s("span",hs,_(n.buyer),1)]),s("div",fs,[gs,s("div",ys,_(n.message),1)])]),n.accepted?(t(),h($,{key:0,to:{path:"/chats",query:{id:n.escrowId}}},{default:u(()=>[c(y,null,{default:u(()=>[q(" to chat ")]),_:1})]),_:2},1032,["to"])):(t(),h(y,{key:1,onClick:l=>i("accept",a(r),n.id)},{default:u(()=>[q(" accept ")]),_:2},1032,["onClick"]))])])]))),128))])):k("",!0)]),_:2},1024)]))),128))])]),_:1})}}}),vs={class:"py-10 space-y-10"},xs={class:"space-y-5"},ws={class:"text-2xl font-medium flex items-center gap-1"},ks=s("p",null,"pending",-1),$s={class:"text-muted-foreground text-base"},qs={class:"space-y-5"},Cs={class:"text-2xl font-medium flex items-center gap-1"},Js=s("p",null,"accepted",-1),Rs={class:"text-muted-foreground text-base"},zs=S({__name:"requests",async setup(B){let m,i;const r=T(),b=([m,i]=O(()=>r.getJobFactory()),m=await m,i(),m),v=N([]),f=N([]),g=z(!1);async function y(){g.value=!0;const p=(await b.getAllJobsOfUser(r.address)).map(o=>({owner:o[0],id:Number(o[1]),title:o[2],description:o[3],price:Number(o[4]),inProcess:o[5],tags:o[6],requests:[]})),e=p.map(o=>b.getJobBuyRequests(o.id));(await Promise.all(e)).forEach((o,x)=>{const R=o.map(w=>({id:Number(w[1]),buyer:w[2],message:w[3],accepted:w[4],escrowId:Number(w[5])}));p[x].requests.push(...R)});const l=p.reduce((o,x)=>(x.requests.some(R=>R.accepted)?o.acceptedJobs.push(x):o.pendingJobs.push(x),o),{pendingJobs:[],acceptedJobs:[]});v.value=l.pendingJobs,f.value=l.acceptedJobs,g.value=!1}U(()=>{y()});async function $(p,e){const l=await(await b.acceptBuyRequest(p,e)).wait();(l==null?void 0:l.status)===1&&await y()}return(p,e)=>{const n=bs,l=ss;return t(),d("div",vs,[s("div",xs,[s("h2",ws,[ks,s("span",$s," ("+_(a(v).length)+") ",1)]),a(v).length?(t(),h(n,{key:0,jobs:a(v),onAccept:$},null,8,["jobs"])):k("",!0),a(g)?(t(),h(l,{key:1})):k("",!0)]),s("div",qs,[s("h2",Cs,[Js,s("span",Rs," ("+_(a(f).length)+") ",1)]),a(f).length?(t(),h(n,{key:0,jobs:a(f),onAccept:$},null,8,["jobs"])):k("",!0),a(g)?(t(),h(l,{key:1})):k("",!0)])])}}});export{zs as default};
