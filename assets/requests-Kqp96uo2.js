import{a as A,C as I,_ as L}from"./Skeleton.vue_vue_type_script_setup_true_lang-eBntFAJk.js";import{c as D,N as F,o as t,j as d,F as C,E as J,D as e,f as c,d as S,z,a as h,w as u,au as V,C as _,B as q,u as a,k as E,aa as P,I as k,_ as j,L as M,t as T,v as O,x as N,a6 as U}from"./index-zZq7Hbs8.js";import{_ as G}from"./ScrollArea.vue_vue_type_script_setup_true_lang-t9-ICoP6.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=D("CornerDownRightIcon",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]),K={},Q={class:"space-y-5"},W={class:"space-y-2 col-span-5"},X={class:"space-y-2 col-span-5"},Y={class:"flex gap-2"};function Z(B,m){const i=A;return t(),d("ul",Q,[(t(),d(C,null,J(4,r=>e("li",{key:r,class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},[e("div",W,[c(i,{class:"h-4 w-[300px]"}),c(i,{class:"h-4 w-[500px]"}),c(i,{class:"h-4 w-[400px]"})]),e("div",X,[e("ul",Y,[e("li",null,[c(i,{class:"h-4 w-[80px]"})]),e("li",null,[c(i,{class:"h-4 w-[130px]"})]),e("li",null,[c(i,{class:"h-4 w-[120px]"})])]),c(i,{class:"h-4 w-[100px]"})])])),64))])}const ee=F(K,[["render",Z]]),se={class:"space-y-5"},te={class:"px-5 py-3 border rounded-md grid grid-cols-11 gap-10"},oe={class:"space-y-2 col-span-5"},ne={class:"font-medium"},ae={class:"text-muted-foreground"},ce={class:"space-y-2 col-span-5"},ie={class:"flex gap-2"},le={class:"flex items-center justify-end"},re={key:0},de={class:"w-[70%] ml-auto mt-5 flex gap-5 items-center"},_e={class:"px-5 py-3 border rounded-md grow flex gap-5 items-center"},pe={class:"space-y-5 grow"},ue={class:"flex"},me=e("span",{class:"w-20 shrink-0"},"from",-1),he={class:"font-medium"},fe={class:"flex"},ge=e("span",{class:"w-20 shrink-0"},"message:",-1),ye={class:"px-3 py-2 bg-secondary border rounded-md grow"},be=S({__name:"RequestSection",props:{jobs:{}},emits:["accept"],setup(B,{emit:m}){const i=m,r=z(-1);return(b,v)=>{const f=L,g=j,y=M,$=V("RouterLink"),p=G;return t(),h(p,{class:"h-[500px]"},{default:u(()=>[e("ul",se,[(t(!0),d(C,null,J(b.jobs,s=>(t(),d("li",{key:s.id},[e("div",te,[e("div",oe,[e("div",ne,_(s.title)+" #"+_(s.id),1),e("div",ae,_(s.description),1)]),e("div",ce,[e("ul",ie,[(t(!0),d(C,null,J(s.tags,(n,l)=>(t(),d("li",{key:l},[c(f,{variant:"secondary"},{default:u(()=>[q(_(n),1)]),_:2},1024)]))),128))]),c(g,null,{default:u(()=>[q(_(s.price),1)]),_:2},1024)]),e("div",le,[c(y,{disabled:!s.requests.length,variant:"outline",size:"icon",onClick:n=>r.value=a(r)===s.id?-1:s.id},{default:u(()=>[c(a(I),{class:E(["transition-transform",{"rotate-180":s.id===a(r)}])},null,8,["class"])]),_:2},1032,["disabled","onClick"])])]),c(P,{"enter-active-class":"transition-all duration-500 ease","leave-active-class":"transition-all duration-500 ease","enter-from-class":"opacity-0 translate-x-[10rem]","leave-to-class":"opacity-0 translate-x-[10rem]"},{default:u(()=>[s.requests.length&&s.id===a(r)?(t(),d("ul",re,[(t(!0),d(C,null,J(s.requests,n=>(t(),d("li",{key:n.id},[e("div",de,[c(a(H),{size:16}),e("div",_e,[e("div",pe,[e("div",ue,[me,e("span",he,_(n.buyer),1)]),e("div",fe,[ge,e("div",ye,_(n.message),1)])]),n.accepted?(t(),h($,{key:0,to:{path:"/chats",query:{id:n.escrowId}}},{default:u(()=>[c(y,null,{default:u(()=>[q("chat")]),_:1})]),_:2},1032,["to"])):(t(),h(y,{key:1,onClick:l=>i("accept",a(r),n.id)},{default:u(()=>[q(" accept ")]),_:2},1032,["onClick"]))])])]))),128))])):k("",!0)]),_:2},1024)]))),128))])]),_:1})}}}),ve={class:"py-10 space-y-10"},xe={class:"space-y-5"},we={class:"text-2xl font-medium flex items-center gap-1"},ke=e("p",null,"pending",-1),$e={class:"text-muted-foreground text-base"},qe={class:"space-y-5"},Ce={class:"text-2xl font-medium flex items-center gap-1"},Je=e("p",null,"accepted",-1),Re={class:"text-muted-foreground text-base"},ze=S({__name:"requests",async setup(B){let m,i;const r=T(),b=([m,i]=O(()=>r.getJobFactory()),m=await m,i(),m),v=N([]),f=N([]),g=z(!1);async function y(){g.value=!0;const p=(await b.getAllJobsOfUser(r.address)).map(o=>({owner:o[0],id:Number(o[1]),title:o[2],description:o[3],price:Number(o[4]),inProcess:o[5],tags:o[6],requests:[]})),s=p.map(o=>b.getJobBuyRequests(o.id));(await Promise.all(s)).forEach((o,x)=>{const R=o.map(w=>({id:Number(w[1]),buyer:w[2],message:w[3],accepted:w[4],escrowId:Number(w[5])}));p[x].requests.push(...R)});const l=p.reduce((o,x)=>(x.requests.some(R=>R.accepted)?o.acceptedJobs.push(x):o.pendingJobs.push(x),o),{pendingJobs:[],acceptedJobs:[]});v.value=l.pendingJobs,f.value=l.acceptedJobs,g.value=!1}U(()=>{y()});async function $(p,s){const l=await(await b.acceptBuyRequest(p,s)).wait();(l==null?void 0:l.status)===1&&await y()}return(p,s)=>{const n=be,l=ee;return t(),d("div",ve,[e("div",xe,[e("h2",we,[ke,e("span",$e," ("+_(a(v).length)+") ",1)]),a(v).length?(t(),h(n,{key:0,jobs:a(v),onAccept:$},null,8,["jobs"])):k("",!0),a(g)?(t(),h(l,{key:1})):k("",!0)]),e("div",qe,[e("h2",Ce,[Je,e("span",Re," ("+_(a(f).length)+") ",1)]),a(f).length?(t(),h(n,{key:0,jobs:a(f),onAccept:$},null,8,["jobs"])):k("",!0),a(g)?(t(),h(l,{key:1})):k("",!0)])])}}});export{ze as default};
