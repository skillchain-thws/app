import{_ as Ce}from"./Input.vue_vue_type_script_setup_true_lang-JG_JYTrl.js";import{_ as Ie}from"./Textarea.vue_vue_type_script_setup_true_lang-nzfDESMa.js";import{c as K,N as Re,o,j as l,r as O,d as A,t as fe,v as X,z as g,y as de,a8 as M,a6 as he,u as e,D as s,F as D,E as L,f as t,k as R,C as u,a9 as ne,a as B,w as r,I as b,B as y,J as re,H as Z,aa as Be,K as ee,L as ye,R as ve,O as De,P as Me,ab as Fe,ac as Se,h as le,m as se,ad as je,ae as Ue,af as Ae,ag as Ve,ah as Ne,x as ae,a3 as ze,ai as Ee,aj as qe,G as ue,ak as pe,al as Oe,am as Pe,an as Ye,ao as me,_ as He}from"./index-P5fyV6OH.js";import{_ as Te}from"./ScrollArea.vue_vue_type_script_setup_true_lang-5Wc5q5u5.js";import{a as Je}from"./BaseSearch.vue_vue_type_script_setup_true_lang-yYc41I2c.js";/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=K("ForwardIcon",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=K("MessageCircleOffIcon",[["path",{d:"M20.5 14.9A9 9 0 0 0 9.1 3.5",key:"1iebmn"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.6 5.6C3 8.3 2.2 12.5 4 16l-2 6 6-2c3.4 1.8 7.6 1.1 10.3-1.7",key:"1ov8ce"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=K("MoreVerticalIcon",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=K("ReplyIcon",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-vue-next v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=K("StarIcon",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),We={},Xe={class:"text-highlight italic"};function Ze(v,a){return o(),l("span",Xe,[O(v.$slots,"default")])}const we=Re(We,[["render",Ze]]),es={class:"py-3"},ss=s("p",{class:"text-sm text-center text-muted-foreground"}," this channel is closed ",-1),ts={key:0},os={class:"border px-4 py-3 rounded-md mt-6 space-y-3 w-4/5 mx-auto"},as={class:"flex items-center gap-3 min-h-10"},ns={class:"flex items-center gap-1"},rs={class:"text-muted-foreground"},ls={key:0,class:"bg-secondary p-3 rounded-md space-y-1"},cs={class:"text-muted-foreground"},is={key:0,class:"border px-4 py-3 rounded-md w-4/5 mx-auto mt-3"},ds={key:0,class:"text-destructive"},us={class:"flex items-center gap-3"},ps={class:"flex items-center gap-1"},ms=["onClick"],_s={class:"mt-1"},fs={class:"w-1/2 space-y-3"},hs={key:0,class:"text-destructive"},ys={key:1,class:"text-destructive"},vs=A({__name:"ChatReview",props:{escrowId:{}},async setup(v){let a,m;const w=v,F=fe(),k=([a,m]=X(()=>F.getReviewFactory()),a=await a,m(),a),f=g(),$=g(0),n=g(""),S=g(!1),C=g(!1);de(n,c=>{c.length>=5&&(C.value=!1)});async function H(){if(S.value=!1,C.value=!1,$.value<1||$.value>5){S.value=!0;return}if(n.value.length<5){C.value=!0;return}const _=await(await k.createReview(w.escrowId,$.value,n.value)).wait();(_==null?void 0:_.status)===1&&await G()}const j=g(),V=g(""),q=g(!1),T=g(!1);de(V,c=>{c.length>=5&&(q.value=!1)});async function N(){if(!f.value)return;if(q.value=!1,V.value.length<5){q.value=!0;return}const _=await(await k.createResponse(f.value.id,V.value)).wait();(_==null?void 0:_.status)===1&&console.log(await k.getResponse(f.value.id))}function te(c){$.value=c,S.value=!1}const P=g(M),U=g(M);async function G(){try{const c=await k.getReviewByEscrowId(w.escrowId);if(c[2]===M||c[3]===M)return;f.value={timestamp:Number(c[0]),rating:Number(c[1]),reviewingAddress:c[2],beingReviewedAddress:c[3],reviewComment:c[4],relevantEscrowId:Number(c[5]),responded:c[6],id:Number(c[7])},P.value=(await ee(f.value.reviewingAddress)).userName,U.value=(await ee(f.value.beingReviewedAddress)).userName;const _=await k.getResponse(f.value.id);if(_[1]===M)return;j.value={timestamp:Number(_[0]),responder:_[1],responseComment:_[2]}}catch(c){console.log(c)}}return he(G),(c,_)=>{const p=ye,i=we,I=Ie;return o(),l("div",es,[ss,e(f)?(o(),l("div",ts,[s("div",os,[s("div",as,[s("ul",ns,[(o(),l(D,null,L(5,h=>s("li",{key:h},[t(e(_e),{class:R({"fill-primary":h<=e(f).rating}),"stroke-width":"1.25"},null,8,["class"])])),64))]),s("p",rs,u(("useDateFormat"in c?c.useDateFormat:e(ne))(e(f).timestamp,"HH:mm DD.MM.YYYY").value),1),e(P)===e(F).user.userName&&!e(j)?(o(),B(p,{key:0,size:"icon",class:"ml-auto",variant:"ghost",onClick:_[0]||(_[0]=h=>T.value=!e(T))},{default:r(()=>[t(e(Qe))]),_:1})):b("",!0)]),s("p",null,[t(i,null,{default:r(()=>[y(u(e(P))+": ",1)]),_:1}),y(" "+u(e(f).reviewComment),1)]),e(j)?(o(),l("div",ls,[s("p",cs,u(("useDateFormat"in c?c.useDateFormat:e(ne))(e(j).timestamp,"HH:mm DD.MM.YYYY").value),1),s("p",null,[t(i,null,{default:r(()=>[y(u(e(U))+": ",1)]),_:1}),y(" "+u(e(j).responseComment),1)])])):b("",!0)]),t(Be,{"enter-active-class":"transition-all","leave-active-class":"transition-all","enter-from-class":"translate-y-[-30px] opacity-0","leave-to-class":"translate-y-[-30px] opacity-0"},{default:r(()=>[e(T)?(o(),l("div",is,[s("form",{class:"space-y-3",onSubmit:re(N,["prevent"])},[t(I,{modelValue:e(V),"onUpdate:modelValue":_[1]||(_[1]=h=>Z(V)?V.value=h:null),class:R({"border-destructive focus-visible:ring-destructive":e(q)}),placeholder:"your respond..."},null,8,["modelValue","class"]),e(q)?(o(),l("p",ds," response must have at least 5 characters ")):b("",!0),t(p,{class:"w-full mt-3"},{default:r(()=>[y(" response ")]),_:1})],32)])):b("",!0)]),_:1})])):(o(),l("form",{key:1,class:"flex flex-col items-center justify-center gap-3 mt-6",onSubmit:re(H,["prevent"])},[s("div",us,[s("ul",ps,[(o(),l(D,null,L(5,h=>s("li",{key:h,class:"cursor-pointer",onClick:x=>te(h)},[t(e(_e),{class:R({"fill-primary":h<=e($),"text-destructive":e(S)}),"stroke-width":"1.25"},null,8,["class"])],8,ms)),64))]),s("span",_s,u(e($))+" / 5",1)]),s("div",fs,[t(I,{modelValue:e(n),"onUpdate:modelValue":_[2]||(_[2]=h=>Z(n)?n.value=h:null),class:R({"border-destructive focus-visible:ring-destructive":e(C)}),placeholder:"your review..."},null,8,["modelValue","class"]),e(S)?(o(),l("p",hs," rating must be from 1 to 5 stars ")):b("",!0),e(C)?(o(),l("p",ys," comment must have at least 5 characters ")):b("",!0),t(p,{type:"submit",class:"w-full"},{default:r(()=>[y(" submit ")]),_:1})])],32))])}}}),ws={class:"rounded-md bg-secondary w-fit relative"},gs=A({__name:"ChatBox",props:{dir:{default:"left"},parentClass:{}},setup(v){return(a,m)=>(o(),l("div",{class:R(["flex",{"justify-end":a.dir==="right"}])},[s("div",{class:R(["w-2/3",{"flex justify-end":a.dir==="right"}])},[s("div",ws,[s("div",{class:R(a.parentClass??"px-3 py-1 tracking-wide min-w-[100px]")},[O(a.$slots,"default")],2),O(a.$slots,"timestamp")])],2)],2))}}),bs=A({__name:"DropdownMenu",props:{open:{type:Boolean},defaultOpen:{type:Boolean},dir:{},modal:{type:Boolean}},emits:["update:open"],setup(v,{emit:a}){const F=ve(v,a);return(k,f)=>(o(),B(e(Fe),De(Me(e(F))),{default:r(()=>[O(k.$slots,"default")]),_:3},16))}}),xs=A({__name:"DropdownMenuContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},side:{},sideOffset:{default:4},align:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss","entryFocus","openAutoFocus","closeAutoFocus"],setup(v,{emit:a}){const m=v,F=ve(m,a);return(k,f)=>(o(),B(e(je),null,{default:r(()=>[t(e(Se),se({class:[e(le)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",m.class)]},e(F)),{default:r(()=>[O(k.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),ks=A({__name:"DropdownMenuSeparator",props:{asChild:{type:Boolean},as:{}},setup(v){const a=v;return(m,w)=>(o(),B(e(Ue),se(a,{class:"-mx-1 my-1 h-px bg-muted"}),null,16))}}),$s=A({__name:"DropdownMenuItem",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},inset:{type:Boolean},class:{}},setup(v){const a=v;return(m,w)=>(o(),B(e(Ae),se(a,{class:[e(le)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",m.inset&&"pl-8",a.class)]}),{default:r(()=>[O(m.$slots,"default")]),_:3},16,["class"]))}}),Cs=A({__name:"DropdownMenuTrigger",props:{disabled:{type:Boolean},asChild:{type:Boolean},as:{}},setup(v){const a=v;return(m,w)=>(o(),B(e(Ve),se({class:"outline-none"},a),{default:r(()=>[O(m.$slots,"default")]),_:3},16))}}),Is=A({__name:"Separator",props:{orientation:{},decorative:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(v){const a=v;return(m,w)=>(o(),B(e(Ne),{class:R([e(le)("shrink-0 bg-secondary",a.class),a.orientation==="vertical"?"w-px h-full":"h-px w-full"])},null,8,["class"]))}}),Rs={class:"py-10"},Bs={class:"grid grid-cols-3 gap-5"},Ds={class:"relative my-6"},Ms=s("span",{class:"absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 px-3 bg-background"}," to you ",-1),Fs={key:0,class:"space-y-3"},Ss=["onClick"],js={class:"space-y-1"},Us={class:"flex items-center justify-between w-"},As={class:"font-medium"},Vs={class:"font-normal mr-1"},Ns={class:"space-x-1"},zs={class:"text-muted-foreground"},Es={class:"relative my-6"},qs=s("span",{class:"absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 px-3 bg-background"},"from you",-1),Os={key:1,class:"space-y-3"},Ps=["onClick"],Ys={class:"space-y-1"},Hs={class:"flex items-center justify-between w-"},Ts={class:"font-medium"},Js={class:"font-normal mr-1"},Ls={class:"space-x-1"},Ks={class:"text-muted-foreground"},Gs={key:2,class:"pt-6 text-center"},Qs=s("p",{class:"text-muted-foreground"}," there is no chat ",-1),Ws=[Qs],Xs={class:"col-span-2 flex flex-col border rounded-md"},Zs={class:"border-b flex items-center gap-3 p-3"},et={class:"space-x-2"},st={class:"font-medium"},tt={class:"text-muted-foreground"},ot={class:"space-x-2"},at={class:"font-medium"},nt={class:"text-muted-foreground"},rt={class:"ml-auto"},lt={key:0,class:"h-full flex-center"},ct={class:"flex flex-col gap-2 h-full"},it={key:0,class:"text-sm text-center text-muted-foreground"},dt={class:"text-sm text-muted-foreground text-end pr-3 py-1"},ut={class:"mt-auto p-3"},pt={class:"grow"},vt=A({__name:"chats",async setup(v){let a,m;const w=fe(),F=([a,m]=X(()=>w.getEscrowFactory()),a=await a,m(),a),k=([a,m]=X(()=>w.getChatFactory()),a=await a,m(),a),f=ae([]),$=ae([]),n=g({buyer:M,buyerUsername:"n.a.",escrowId:-1,isDone:!1,jobId:-1,money:0,price:0,seller:M,sellerUsername:"n.a.",started:!1,job:{description:"",id:-1,inProcess:!1,owner:M,price:0,tags:[],title:""}}),S=ze(()=>!f.value.length&&!$.value.length||n.value.buyer===M||n.value.seller===M),C=ae([]),H=g("buyer"),j=g(""),V=Pe(),q=Ye();async function T(){const p=[],i=[];for(const h of w.user.escrowIds){const x=await Ee(h);if(!x)return;const z=await ee(x.buyer),E=await ee(x.seller),J=await qe(x.jobId),Q={...x,buyerUsername:z.userName,sellerUsername:E.userName,job:J};ue(z.owner,w.address)?p.push(Q):i.push(Q)}f.value=p,$.value=i;const I=q.query.id;if(I){const h=Number.parseInt(I.toString()),x=p.find(E=>E.escrowId===h);if(x){await N(x);return}const z=i.find(E=>E.escrowId===h);if(z){await N(z);return}}p.length?await N(p[0]):i.length&&await N(i[0])}he(T);async function N(p){n.value.escrowId!==p.escrowId&&(C.value=[],V.push(`/chats?id=${p.escrowId}`),H.value=p.buyerUsername===w.user.userName?"buyer":"seller",n.value=p,C.value=await pe(p.escrowId))}async function te(){const i=await(await F.sendRequest(n.value.escrowId)).wait();(i==null?void 0:i.status)===1&&(n.value.started=!0)}async function P(p){const I=await(await F.respondToRequest(n.value.escrowId,p)).wait();(I==null?void 0:I.status)===1&&(n.value.isDone=!0)}const U=g("");async function G(){if(!U.value)return;const i=await(await k.sendMessage(n.value.escrowId,U.value)).wait();(i==null?void 0:i.status)===1&&(C.value=await pe(n.value.escrowId),U.value="")}const c=([a,m]=X(()=>w.getCommitteeFactory()),a=await a,m(),a);async function _(){await c.openCommitteeReview(n.value.escrowId,10,"something")}return(p,i)=>{const I=Je,h=Is,x=He,z=Te,E=Oe,J=ye,Q=Cs,oe=$s,ce=ks,ge=xs,be=bs,ie=we,Y=gs,xe=vs,ke=Ce;return o(),l("div",Rs,[s("div",Bs,[s("div",{class:R(["col-span-1",e(f).length?"border-none":"border rounded-md"])},[t(I,{modelValue:e(j),"onUpdate:modelValue":i[0]||(i[0]=d=>Z(j)?j.value=d:null),placeholder:"search for chats"},null,8,["modelValue"]),s("div",Ds,[t(h),Ms]),t(z,{class:"h-[600px]"},{default:r(()=>[e(f).length?(o(),l("ul",Fs,[(o(!0),l(D,null,L(e(f),d=>(o(),l("li",{key:d.escrowId,class:"cursor-pointer",onClick:W=>N(d)},[s("div",{class:R(["border rounded-md px-4 py-3 hover:border-primary transition-colors",{"border-primary":d.escrowId===e(n).escrowId}])},[s("div",js,[s("div",Us,[s("p",As," #"+u(d.jobId)+" "+u(d.job.title),1),t(x,null,{parent:r(()=>[s("span",Vs,u(d.job.price),1)]),_:2},1024)]),s("div",Ns,[s("span",null,u(d.sellerUsername),1),s("span",zs,u(e(me)(d.seller)),1)])])],2)],8,Ss))),128))])):b("",!0),s("div",Es,[t(h),qs]),e($).length?(o(),l("ul",Os,[(o(!0),l(D,null,L(e($),d=>(o(),l("li",{key:d.escrowId,class:"cursor-pointer",onClick:W=>N(d)},[s("div",{class:R(["border rounded-md px-4 py-3 hover:border-primary transition-colors",{"border-primary":d.escrowId===e(n).escrowId}])},[s("div",Ys,[s("div",Hs,[s("p",Ts," #"+u(d.jobId)+" "+u(d.job.title),1),t(x,null,{parent:r(()=>[s("span",Js,u(d.job.price),1)]),_:2},1024)]),s("div",Ls,[s("span",null,u(d.buyerUsername),1),s("span",Ks,u(e(me)(d.buyer)),1)])])],2)],8,Ps))),128))])):b("",!0),e(S)?(o(),l("div",Gs,Ws)):b("",!0)]),_:1})],2),s("div",Xs,[s("div",Zs,[e(H)==="buyer"?(o(),l(D,{key:0},[t(E,{address:e(n).seller,size:35},null,8,["address"]),s("div",et,[s("span",st,u(e(n).sellerUsername),1),s("span",tt,u(e(n).seller),1)])],64)):(o(),l(D,{key:1},[t(E,{address:e(n).buyer,size:35},null,8,["address"]),s("div",ot,[s("span",at,u(e(n).buyerUsername),1),s("span",nt,u(e(n).buyer),1)]),s("div",rt,[e(n).started&&!e(n).isDone?(o(),B(be,{key:0},{default:r(()=>[t(Q,null,{default:r(()=>[t(J,{variant:"outline",size:"icon",class:"h-8 w-8"},{default:r(()=>[t(e(Ge),{size:20})]),_:1})]),_:1}),t(ge,{align:"end"},{default:r(()=>[t(oe,{onClick:_},{default:r(()=>[y(" request committee ")]),_:1}),t(ce),t(oe,{onClick:i[1]||(i[1]=d=>P(!0))},{default:r(()=>[y(" accept ")]),_:1}),t(ce),t(oe,{class:"text-destructive",onClick:i[2]||(i[2]=d=>P(!1))},{default:r(()=>[y(" decline ")]),_:1})]),_:1})]),_:1})):b("",!0)])],64))]),e(S)?(o(),l("div",lt,[t(e(Ke),{size:100,"stroke-width":"0.75",class:"text-muted-foreground"})])):(o(),B(z,{key:1,class:"grow p-3"},{default:r(()=>[s("div",ct,[e(n).started&&e(C).length===0?(o(),l("p",it," you both are now connected ")):b("",!0),e(n).started?b("",!0):(o(),l(D,{key:1},[e(H)==="buyer"?(o(),l(D,{key:0},[t(Y,null,{default:r(()=>[t(ie,null,{default:r(()=>[y(u(e(n).sellerUsername),1)]),_:1}),y(" hat accepted your job buy request! ")]),_:1}),t(Y,null,{default:r(()=>[y(" click accept to connect with them. ")]),_:1}),t(Y,{"parent-class":""},{default:r(()=>[t(J,{size:"sm",onClick:te},{default:r(()=>[y(" accept ")]),_:1})]),_:1})],64)):(o(),l(D,{key:1},[t(Y,{dir:"right"},{default:r(()=>[y(" you hat already sent job request to "),t(ie,null,{default:r(()=>[y(u(e(n).buyerUsername),1)]),_:1}),y(". ")]),_:1}),t(Y,{dir:"right"},{default:r(()=>[y(" wait for them to accept! ")]),_:1})],64))],64)),(o(!0),l(D,null,L(e(C),({sender:d,timestamp:W,content:$e})=>(o(),B(Y,{key:W,dir:e(ue)(d,e(w).address)?"right":"left"},{timestamp:r(()=>[s("p",dt,u(("useDateFormat"in p?p.useDateFormat:e(ne))(W,"HH:mm DD.MM.YY").value),1)]),default:r(()=>[y(u($e)+" ",1)]),_:2},1032,["dir"]))),128)),e(n).isDone?(o(),B(xe,{key:2,"escrow-id":e(n).escrowId},null,8,["escrow-id"])):b("",!0)])]),_:1})),s("div",ut,[s("form",{class:"flex items-center gap-3",onSubmit:re(G,["prevent"])},[s("div",pt,[t(ke,{modelValue:e(U),"onUpdate:modelValue":i[3]||(i[3]=d=>Z(U)?U.value=d:null),placeholder:"type something here..."},null,8,["modelValue"])]),t(J,{size:"icon",disabled:e(S)||e(n).isDone},{default:r(()=>[t(e(Le),{size:20})]),_:1},8,["disabled"])],32)])])])])}}});export{vt as default};
